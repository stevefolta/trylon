trylon Bench

main: args
	bench = BenchObject new
	start-time = System milliseconds
	num-sends = bench nfibs: 33
	time = System milliseconds - start-time
	print-line: "nfibs: 33 = " + num-sends string
	print-line: time string + " milliseconds"
	sends-per-second = num-sends float / (time float / 1000.0)
	if sends-per-second > 1000000.0
		send: (sends-per-second / 1000000.0, " MILLION sends per second.")
	else
		send: (sends-per-second, " sends per second.")
	return 0


class BenchObject
	create
		# Nothing to do.

	nfibs: n
		# We're returning the total number of sends, including the
		# currently-executing send of 'nfibs:'.

		if n < 2
			# 2 sends: nfibs: (this one), <
			return 2
		else
			# 6 sends, not counting the calls to nfibs: (they'll count themselves):
			# nfibs: (this one), <, -, -, +, +
			return (nfibs: n - 1) + (nfibs: n - 2) + 6

