trylon Object

extend Standard Object
	c-preamble
		#include <stdio.h>
		#include <stdlib.h>

	c-fn raw-new
		return CloneObj_(this_);
	
	c-fn object-ptr
		return BuildBytePtr_((byte_ptr_) this_);
	
	c-fn same-as: other
		return Bool_(this_ == other);
	
	c-fn .proto
		return this_->class_->proto;
	
	c-fn .parent-proto
		return this_->class_->superclass;
	
	c-fn .proto-name
		return this_->class_->name;

	c-fn .object-size
		return BuildInt_(sizeof(classref_) + this_->class_->size);
	
	c-fn .added-fields
		return this_->class_->addedFields;

	c-fn message-not-understood
		fprintf(stderr, "Message not understood.\n");
		exit(1);
	
	iff debugger
		.gather-field-names-into: tuple
			index = 0
			if .parent-proto
				index = .parent-proto .gather-field-names-into: tuple
			for field-name in .added-fields
				tuple at: index put: field-name
				index += 1
			return index


