trylon ShortCircuitAnd
superclass Expression

fields expr1 expr2


create: expr1 with: expr2
	this expr1 = expr1
	this expr2 = expr2


prepare-to-emit
	expr1 prepare-to-emit
	expr2 prepare-to-emit


emit-code: builder
	result = expr1 emit-code: builder
	if !(result is-a: Temporary)
		# If it's already a temporary, we just reuse it for our final result; 
		# otherwise, we need a new temporary.
		temporary = builder get-temporary
		builder add-line: temporary name + " = " + result access + ";"
		result = temporary
	
	builder add-line: "if (Test_(" + result access + ")) {"
	builder indent
	result2 = expr2 emit-code: builder
	builder add-line: result access + " = " + result2 access + ";"
	builder add-line: "}"
	builder unindent
	return result


