trylon ExpandoBitmap

fields bitmap num-bytes growth-increment


create
	growth-increment = 64
	num-bytes = growth-increment
	bitmap = BytePtr new: num-bytes


at: index
	which-byte = index / 8
	if which-byte > num-bytes
		return false
	
	return ((bitmap byte-at: which-byte) & (1 << (index % 8))) != 0


at: index set-to: value
	which-byte = index / 8
	if which-byte > num-bytes
		expand: which-byte + 1
	
	mask = 1 << (index % 8)
	if value
		(bitmap byte-at: which-byte) |= mask
	else
		(bitmap byte-at: which-byte) &= ~mask


primitive-fn next-clear-from: index


expand: needed-num-bytes
	new-num-bytes = num-bytes + growth-increment
	while new-num-bytes < needed-num-bytes
		new-num-bytes += growth-increment
	
	new-bitmap = BytePtr new: new-num-bytes
	new-bitmap copy-from: bitmap length: num-bytes

	bitmap = new-bitmap
	num-bytes = new-num-bytes



