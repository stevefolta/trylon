trylon Compiler

# See "Compiler Compiler" for the guts of this, and an explanation of why it is
# separate from this... (it's Trylon's fault, not Trylid's).


compile: compile-symbols
	start-ms = nil
	iff time-compilation
		start-ms = System milliseconds
	the-compiler = Compiler new
	the-compiler compile-program: compile-symbols
	iff time-compilation
		elapsed-time = System milliseconds - start-ms
		print-line: "Compilation took " + elapsed-time string + "ms."
	return the-compiler return-value

compile
	compile: List new


iff in-trylid
	compile-file: file as: name into: parent-proto
		if !(parent-proto is-a: ExistingProto)
			parent-proto = ExistingProto new: parent-proto
		the-compiler = Compiler new
		program = the-compiler compile-file: file as: name into: parent-proto
		program _eval
	
	compile-dir: dir as: name into: parent-proto
		if !(parent-proto is-a: ExistingProto)
			parent-proto = ExistingProto new: parent-proto
		the-compiler = Compiler new
		program = the-compiler compile-dir: dir as: name into: parent-proto
		program _eval
		the-compiler = nil
	
	parse-file: file as: name into: parent-proto
		if !(parent-proto is-a: ExistingProto)
			parent-proto = ExistingProto new: parent-proto
		if !(file is-a: File)
			file = File new: file
		the-compiler = Compiler new
		program = the-compiler compile-file: file as: name into: parent-proto
		return program



# Copyright 2007 Steve Folta.  See the License file.

