trylon Send
superclass TrylidExpression

fields name object arguments

# Very special for prepare-to-emit handling of proto functions.
fields proto-result-function


create: name object: object arguments: arguments
	this name = name
	this object = object
	this arguments = arguments

message: name to: object with: arguments
	return new: name object: object arguments: arguments


prepare-to-emit
	object prepare-to-emit

	for arg in arguments
		arg prepare-to-emit
	
	# Handle proto functions, to ensure the proto is loaded.
	function = nil
	if object is-a: FunctionCall
		function = object function
	else if object is-a: Send
		function = object proto-result-function
	if function && (function is-a: ProtoFunction)
		proto-result-function = function proto lookup-function: name


convert-to-setter-call: value
	if name ends-with: ":"
		name += "put:"
	else
		name += ":"
	arguments append: value


copy
	copied-args = List new
	for arg in arguments
		copied-args append: arg
	return Send new: name object: object arguments: copied-args




# Copyright 2007 Steve Folta.  See the License file.

