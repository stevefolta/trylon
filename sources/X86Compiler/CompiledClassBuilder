trylon CompiledClassBuilder
superclass ClassBuilder

fields created-proto

created-protos = nil 	# A List to keep them from being GC'd.


create: compiled-class
	super create: compiled-class
	if created-protos == nil
		created-protos = List new


build
	# Create the new class in the runtime.
	proto = live-proto

	# Add in all the functions.
	build-functions-into: proto

	return proto


live-proto
	# Create it, if we haven't already.
	if created-proto == nil
		compiled-class = class-context
		parent-object = nil
		if compiled-class parent
			parent-object = live-proto-for: compiled-class parent
		superclass-object = nil
		if compiled-class superclass
			superclass-object = live-proto-for: compiled-class superclass
		else
			superclass-object = Object
		field-names = List new
		for field in compiled-class fields
			field-names append: field name intern
		class-info = 	--
			CImplementation Class 	--
				new: compiled-class name intern --
				field-names: field-names 	--
				parent: parent-object superclass: superclass-object
		created-proto = class-info proto
		created-protos append: created-proto

	return created-proto


