trylon MethodBuilder

fields temporaries loops
fields int-literals string-literals float-literals dict-literals

create
	temporaries = Literals new
	loops = Literals new
	int-literals = Literals new
	string-literals = Literals new
	float-literals = Literals new
	dict-literals = Literals new


get-temporary
	temp-num = next-temporary-num
	next-temporary-num += 1
	temporary = Temporary new: temp-num
	if temp-num > temporaries next-index - 1
		temporaries add: temporary
	return temporary
	# Really want:
	# temp-num = next-temporary-num
	# next-temporary-num += 1
	# if temp-num < temporaries next-index
	# 	return temporaries at: temp-num
	# temporary = Temporary new: temp-num
	# temporaries add: temporary
	# return temporary


emit: stream
	stream write-line: "{"

	# Declarations.
	temporaries emit-declarations-on: stream
	# loops emit-declarations-on: stream 	# Not needed.
	int-literals emit-declarations-on: stream
	string-literals emit-declarations-on: stream
	float-literals emit-declarations-on: stream
	dict-literals emit-declarations-on: stream

	# Declare selectors.
	# ...

	# External declarations.
	if !external-declarations is-empty
		for declaration in external-declarations
			stream write: "\t"
			stream write-line: declaration

	# ...

	stream write-line

	# Emit the body of the code.
	stream write: code string

	stream write-line: "\treturn nil;"
	stream write-line: "}"


#####

class Literals
	field literals next-index

	create
		literals = List new
		next-index = 0
	
	add: literal
		literal index = next-index
		next-index += 1
		literals append: literal
	
	emit-declarations-on: stream
		for literal in literals
			literal emit-declaration: stream
	

